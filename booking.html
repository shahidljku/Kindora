<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kindora â€“ Booking</title>
    <link href="booking.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="kindora-logo.ico" />
    <style>
      .traveler-details {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
      }
      .upi-options img {
        width: 200px;
        margin-top: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div id="nav1">
      <a href="home.php" id="logo-link">
        <div id="logo">Kindora</div>
      </a>

      <div id="nav2">
        <div class="inspire-wrapper">
          <a class="a1 dropbtn" id="inspireBtn" href="#">Be Inspired</a>
          <div class="scroll-container1" id="inspireScroll">
            <a data-href="asia.php">
              <div class="image-wrapper1">
                <img src="web images/banner/asia.avif" alt="Asia" />
                <div class="overlay-text">Asia</div>
              </div>
            </a>

            <a data-href="europe.php">
              <div class="image-wrapper1">
                <img src="web images/banner/europe.jpeg" alt="Europe" />
                <div class="overlay-text">Europe</div>
              </div>
            </a>

            <a data-href="africa.php">
              <div class="image-wrapper1">
                <img src="web images/banner/africa.avif" alt="Africa" />
                <div class="overlay-text">Africa</div>
              </div>
            </a>

            <a data-href="north_america.php">
              <div class="image-wrapper1">
                <img
                  src="web images/banner/north america.avif"
                  alt="North America"
                />
                <div class="overlay-text">North America</div>
              </div>
            </a>

            <a data-href="south_america.php">
              <div class="image-wrapper1">
                <img src="7 wonders/Machu Picchu.jpeg" alt="South America" />
                <div class="overlay-text">South America</div>
              </div>
            </a>

            <a data-href="australia.php">
              <div class="image-wrapper1">
                <img src="web images/banner/australia.avif" alt="Australia" />
                <div class="overlay-text">Australia</div>
              </div>
            </a>

            <a data-href="antarctica.php">
              <div class="image-wrapper1">
                <img src="web images/banner/antarctica.jpeg" alt="Antarctica" />
                <div class="overlay-text">Antarctica</div>
              </div>
            </a>
          </div>
        </div>

        <a class="a1 dropbtn" href="explore.php">Places to go</a>
        <a class="a1 dropbtn" href="things_to_do.php">Things to do</a>
        <a class="a1 dropbtn" href="booking.php">Plan Your Trip</a>
      </div>

      <button class="menu" onclick="toggleMenu()">â˜°</button>

      <div id="sidebar" class="sidebar">
        <button class="closebtn" onclick="toggleMenu()">Ã—</button>
        <a href="home.php">Home</a>
        <a href="login.php">Login/Register</a>
        <a href="booking.php">Book Your Trips</a>
        <a href="mytrips.php">My Trips</a>
        <a href="aboutus.php">About</a>
        <a href="contactus.php">Contact</a>
      </div>
    </div>

    <section class="booking-section">
      <h1>Book Your Dream Trip</h1>
      <p>
        Fill in your details below and we'll make your journey unforgettable.
      </p>

      <div class="booking-container">
        <form id="bookingForm" class="booking-form">
          <label>Full Name</label>
          <input type="text" id="name" required />

          <label>Email Address</label>
          <input type="email" id="email" required />

          <label>Phone Number</label>
          <input type="tel" id="phone" required />

          <label>Travel Date</label>
          <input type="date" id="date" required />

          <label>Adults</label>
          <input type="number" id="guests" min="1" value="1" required />
          <div id="adultDetails"></div>

          <label>Children</label>
          <input type="number" id="children" min="0" value="0" />
          <div id="childrenDetails"></div>

          <label>Choose Destination</label>
          <select id="destination" required>
            <option value="">-- Select --</option>
            <option value="Paris">Paris</option>
            <option value="Maldives">Maldives</option>
            <option value="Bali">Bali</option>
            <option value="New York">New York</option>
            <option value="Dubai">Dubai</option>
          </select>

          <label>Payment Method</label>
          <select id="payment" required>
            <option value="">-- Select Payment Method --</option>
            <option value="Credit Card">Credit Card</option>
            <option value="Debit Card">Debit Card</option>
            <option value="UPI">UPI</option>
            <option value="Net Banking">Net Banking</option>
          </select>
          <div id="paymentDetails"></div>

          <label>Special Requests</label>
          <textarea id="message" rows="4"></textarea>

          <button type="submit">Confirm Booking</button>
        </form>
        <!-- Add this right after </form> and before </div> closing the booking-container -->
        <div class="booking-summary">
          <h2>Booking Summary</h2>
          <div id="priceSummary">
            <div class="summary-row">
              <span>Destination:</span>
              <span id="summaryDestination">Select destination</span>
            </div>
            <div class="summary-row">
              <span>Adults:</span>
              <span id="summaryAdults">1</span>
            </div>
            <div class="summary-row">
              <span>Children:</span>
              <span id="summaryChildren">0</span>
            </div>
            <div class="summary-row total-row">
              <span>Total Amount:</span>
              <span id="summaryTotal">$0</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="footer-container">
        <div class="footer-left">
          <h3>Kindora</h3>
          <p>
            Your gateway to dream destinations around the globe.<br />
            Explore, travel, and create unforgettable memories with us.
          </p>
        </div>

        <div class="footer-middle">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="home.php">Home</a></li>
            <li><a href="#">Be Inspired</a></li>
            <li><a href="explore.php">Places to Go</a></li>
            <li><a href="things_to_do.php">Things to Do</a></li>
            <li><a href="booking.php">Plan Your Trip</a></li>
            <li><a href="contactus.php">Contact</a></li>
          </ul>
        </div>

        <div class="footer-right">
          <h4>Stay Connected</h4>
          <form class="subscribe-form">
            <input type="email" placeholder="Enter your email" required />
            <button type="submit">Subscribe</button>
          </form>
          <h4>Follow Us</h4>
          <div class="social-icons">
            <a href="#"><img src="icons/facebook.jpeg" alt="Facebook" /></a>
            <a href="#"><img src="icons/instagram.jpeg" alt="Instagram" /></a>
            <a href="#"><img src="icons/twitter.avif" alt="Twitter" /></a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Kindora. All rights reserved.</p>
      </div>
    </footer>

    <script src="users.js"></script>
    <script>
      // Redirect if not logged in & prefill
      document.addEventListener("DOMContentLoaded", function () {
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (!currentUser) {
          alert("ðŸ”’ Please login first to book a trip!");
          return (window.location.href = "login.php");
        }
        // Prefill Full Name & Email using IDs
        const nameField = document.getElementById("name");
        const emailField = document.getElementById("email");
        if (nameField)
          nameField.value = currentUser.fullName || currentUser.username || "";
        if (emailField) emailField.value = currentUser.email || "";
      });

      function toggleMenu() {
        document.getElementById("sidebar").classList.toggle("open");
      }

      const adultsInput = document.getElementById("guests");
      const adultDetails = document.getElementById("adultDetails");
      adultsInput.addEventListener("input", () => {
        adultDetails.innerHTML = "";
        let c = parseInt(adultsInput.value) || 0;
        for (let i = 1; i <= c; i++) {
          adultDetails.innerHTML += `
      <div class="traveler-details">
  <h4>Adult ${i}</h4>
  <label>Name</label><input type="text" required />
  <label>Date of Birth</label>
    <input type="date" class="dob-input" required />
  <label>Age</label>
  <input type="number" class="age-output" readonly />
  <label>Passport No.</label><input type="text" required />
</div>
`;
        }
      });

      const childrenInput = document.getElementById("children");
      const childrenDetails = document.getElementById("childrenDetails");
      childrenInput.addEventListener("input", () => {
        childrenDetails.innerHTML = "";
        let c = parseInt(childrenInput.value) || 0;
        for (let i = 1; i <= c; i++) {
          childrenDetails.innerHTML += `
      <div class="traveler-details">
  <h4>Child ${i}</h4>
  <label>Name</label><input type="text" required />
  <label>Date of Birth</label>
  <input type="date" class="dob-input" required />
  <label>Age</label>
  <input type="number" class="age-output" readonly />
</div>
`;
        }
      });

      const paymentSelect = document.getElementById("payment");
      const paymentDetails = document.getElementById("paymentDetails");
      paymentSelect.addEventListener("change", () => {
        paymentDetails.innerHTML = "";
        if (
          paymentSelect.value === "Credit Card" ||
          paymentSelect.value === "Debit Card"
        ) {
          paymentDetails.innerHTML = `
        <label>Card Number</label><input type="text" required />
        <label>Expiry Date</label><input type="month" required />
        <label>CVV</label><input type="password" maxlength="3" required />`;
        } else if (paymentSelect.value === "UPI") {
          paymentDetails.innerHTML = `
        <label>UPI ID</label><input type="text" id="upiId" placeholder="example@upi" />
        <p>OR Scan QR Code:</p>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=example@upi&pn=Kindora" alt="UPI QR Code" />`;
        } else if (paymentSelect.value === "Net Banking") {
          paymentDetails.innerHTML = `
        <label>Bank Name</label><input type="text" required />
        <label>Account Number</label><input type="text" required />`;
        }
      });

      // Handle booking submission
      document
        .getElementById("bookingForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          if (!currentUser) {
            alert("ðŸ”’ Please login first!");
            return (window.location.href = "login.php");
          }

          // Read form values
          const formData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            travelDate: document.getElementById("date").value,
            adults: document.getElementById("guests").value,
            children: document.getElementById("children").value,
            destination: document.getElementById("destination").value,
            paymentMethod: document.getElementById("payment").value,
            specialRequests: document.getElementById("message").value,
          };

          // Create trip object
          const trip = {
            id: "TRIP" + Date.now().toString().slice(-6),
            destination: formData.destination,
            date: formData.travelDate,
            status: "confirmed",
            amount: calculatePrice(
              formData.destination,
              formData.adults,
              formData.children
            ),
            package: "Custom Package",
            bookingDate: new Date().toISOString().split("T")[0],
            details: formData,
          };

          // Save to user's bookings
          if (!currentUser.bookedTrips) currentUser.bookedTrips = [];
          currentUser.bookedTrips.push(trip);

          // Add reward points
          currentUser.rewardPoints = (currentUser.rewardPoints || 0) + 100;

          // Update localStorage
          localStorage.setItem("currentUser", JSON.stringify(currentUser));
          localStorage.setItem("latestBooking", JSON.stringify(trip));

          // Also save to allBookings for admin
          let allBookings =
            JSON.parse(localStorage.getItem("allBookings")) || [];
          allBookings.push(trip);
          localStorage.setItem("allBookings", JSON.stringify(allBookings));

          alert(
            `ðŸŽ‰ Booking Confirmed!\nTrip ID: ${trip.id}\nDestination: ${trip.destination}\nAmount: ${trip.amount}`
          );
          window.location.href = "confirmation.php";
        });

      // Price calculator function
      function calculatePrice(destination, adults, children) {
        const prices = {
          Paris: 2500,
          Maldives: 4000,
          Bali: 1800,
          "New York": 3000,
          Dubai: 2800,
        };

        const basePrice = prices[destination] || 2000;
        const adultCount = parseInt(adults) || 1;
        const childCount = parseInt(children) || 0;

        const total = basePrice * adultCount + basePrice * 0.7 * childCount;
        return "$" + Math.round(total);
      }

      const inspireBtn = document.getElementById("inspireBtn");
      const scrollContainer = document.getElementById("inspireScroll");

      inspireBtn.addEventListener("click", function (e) {
        e.preventDefault();
        if (scrollContainer.style.display === "flex") {
          scrollContainer.style.display = "none";
        } else {
          scrollContainer.style.display = "flex";
        }
      });

      document.querySelectorAll(".scroll-container1 a").forEach((a) => {
        a.addEventListener("dblclick", (e) => {
          const href = a.getAttribute("data-href");
          if (href) {
            window.location.href = href;
          }
        });

        a.addEventListener("click", (e) => {
          e.preventDefault();
        });
      });

      const ctaBtn = document.querySelector(".cta-btn");
      if (ctaBtn) {
        ctaBtn.addEventListener("click", () => {
          const popular = document.getElementById("popular");
          if (popular) {
            popular.scrollIntoView({ behavior: "smooth" });
          }
        });
      }
    </script>
    <script>
      // Update price summary
      function updatePriceSummary() {
        const destination = document.getElementById("destination").value;
        const adults = document.getElementById("guests").value;
        const children = document.getElementById("children").value;

        document.getElementById("summaryDestination").textContent =
          destination || "Select destination";
        document.getElementById("summaryAdults").textContent = adults;
        document.getElementById("summaryChildren").textContent = children;

        if (destination) {
          const total = calculatePrice(destination, adults, children);
          document.getElementById("summaryTotal").textContent = total;
        } else {
          document.getElementById("summaryTotal").textContent = "$0";
        }
      }

      // Add event listeners for price updates
      document
        .getElementById("destination")
        .addEventListener("change", updatePriceSummary);
      document
        .getElementById("guests")
        .addEventListener("input", updatePriceSummary);
      document
        .getElementById("children")
        .addEventListener("input", updatePriceSummary);
    </script>
    <script>
      // Compute age given a DOB string in YYYY-MM-DD
      function computeAge(dobString) {
        const today = new Date();
        const [y, m, d] = dobString.split("-").map(Number);
        const birthDate = new Date(y, m - 1, d);
        let age = today.getFullYear() - birthDate.getFullYear();
        const mDiff = today.getMonth() - birthDate.getMonth();
        if (
          mDiff < 0 ||
          (mDiff === 0 && today.getDate() < birthDate.getDate())
        ) {
          age--;
        }
        return age;
      }

      // Attach listener to any DOB input
      function attachAgeListeners(container) {
        container.querySelectorAll(".dob-input").forEach((dobInput) => {
          dobInput.addEventListener("change", () => {
            const ageField = dobInput
              .closest(".traveler-details")
              .querySelector(".age-output");
            if (dobInput.value) {
              ageField.value = computeAge(dobInput.value);
            } else {
              ageField.value = "";
            }
          });
        });
      }

      // Whenever traveler-details are regenerated, reattach listeners
      function refreshAgeHandlers() {
        attachAgeListeners(document.getElementById("adultDetails"));
        attachAgeListeners(document.getElementById("childrenDetails"));
      }

      // After dynamic generation of traveler-details
      adultsInput.addEventListener("input", () => {
        // existing code to render adults...
        refreshAgeHandlers();
      });
      childrenInput.addEventListener("input", () => {
        // existing code to render children...
        refreshAgeHandlers();
      });

      // Also attach on initial load in case of default one adult
      document.addEventListener("DOMContentLoaded", refreshAgeHandlers);
    </script>
  </body>
</html>
